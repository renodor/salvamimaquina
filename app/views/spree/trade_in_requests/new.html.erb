<%= render 'spree/shared/banner', banner: @banner %>
<div id="trade-in-form">
  <%= simple_form_for @trade_in_request do |f| %>
    <div id="trade-in-first-part">
      <h2><%= t('product_you_want_to_trade_in') %></h2>

      <div>
        <%=
          select_tag 'trade_in_request[trade_in_category_id]',
          options_for_select(@trade_in_categories.map { |category| [category.name, category.id] }),
          prompt: t('choose_product_category'),
          id: 'trade-in-categories'
        %>
      </div>
      <div>
        <%=
          select_tag 'trade_in_model',
          options_for_select(
            @trade_in_models.map do |model|
              [
                model.name,
                model.id,
                data: {
                  parent_id: model.trade_in_category.id,
                  min_value: model.min_value,
                  max_value: model.max_value,
                  min_value_text: number_to_currency(model.min_value),
                  max_value_text: number_to_currency(model.max_value),
                }
              ]
            end
          ),
          prompt: t('choose_product'),
          id: 'trade-in-models',
          class: 'hidden',
          disabled: true
        %>
      </div>


      <div id="trade-in-model-price" class="hidden" data-min-value="" data-max-value="" disabled>
        <p class="model-name-paragraph"><%= t('you_have_a') %> <b class="model-name"></b></p>
        <p class="model-values">(<%= t('estimated_value_between') %> <b class="model-min-value"></b> <%= t('and') %> <b class="model-max-value"></b>)*</p>
      </div>
    </div>

    <div id="trade-in-second-part" class="hidden" disabled>
      <h2><%= t('what_product_you_want_to_buy') %></h2>

      <div>
        <%=
          select_tag 'taxon',
          options_for_select(@taxons.map { |taxon| [taxon.name, taxon.id] }),
          prompt: t('choose_product_category'),
          id: 'taxons'
        %>
      </div>

      <div>
        <%=
          select_tag 'product',
          options_for_select(
            @products.map do |product|
              [
                product.name,
                product.id,
                data: {
                  parent_id: product.taxons.first.depth == 2 ? @accessories_taxon_id : product.taxon_ids.first,
                  has_variants: product.has_variants?,
                  master_id: product.master.id
                }
              ]
            end
          ),
          prompt: t('choose_product'),
          id: 'products',
          class: 'hidden',
          disabled: true
        %>
      </div>

      <div>
        <%=
          select_tag 'trade_in_request[variant_id]',
          options_for_select(
            @variants.map do |variant|
              [
                "#{variant.name} - #{variant.options_text}",
                variant.id,
                data: { parent_id: variant.product_id }
              ]
            end
          ),
          prompt: t('choose_variant'),
          id: 'variants',
          class: 'hidden',
          disabled: true
        %>
      </div>

      <div id="invalid-trade-in" class="display-none centered-flexbox" disabled>
        <div class="">
          <p><%= t('please_choose_product_with_higher_value') %></p>
        </div>
      </div>

      <div id="variant-infos" class="hidden" disabled>
        <div class="variant-image"><!-- added by JS --></div>
        <div class="variant-price-to-compute centered-flexbox">
          <div>
            <%= t('you_can_by_a') %> <b class="variant-name"><!-- added by JS --></b> - <b class="variant-options"><!-- added by JS --></b>
            <br /><%= t('between') %> <b class="variant-min-price"><!-- added by JS --></b> <%= t('and') %> <b class="variant-max-price"><!-- added by JS --></b>
          </div>
        </div>
        <p class="variant-price-container">(<%= t('instead_of') %> <b class="variant-price"><!-- added by JS --></b>)</p>
      </div>
    </div>

    <%= f.input :name %>
    <%= f.input :email %>
    <%= f.input :shop %>
    <%= f.submit %>
  <% end %>


  <p id="trade-in-disclaimer"><i>*<%= t('trade_in_disclaimer') %></i></p>
</div>